# AI 功能使用说明

## 功能概述

本应用已集成 **Gemini AI** 智能解析功能，可以通过自然语言输入快速创建结构化的待办事项。

## 配置步骤

### 1. 获取 Gemini API 密钥

1. 访问 [Google AI Studio](https://ai.google.dev/)
2. 登录您的 Google 账户
3. 创建新的 API 密钥
4. 复制生成的 API 密钥

### 2. 配置环境变量

1. 打开项目根目录下的 `.env` 文件
2. 将 `your_gemini_api_key_here` 替换为您的实际 API 密钥：

```
GEMINI_API_KEY=your_actual_api_key_here
```

## 使用方法

### 基本操作

- **普通添加**：在输入框中输入待办事项，按 `Enter` 键
- **AI 智能解析**：在输入框中输入自然语言描述，按 `Shift+Enter` 键

### AI 解析功能

当您按下 `Shift+Enter` 时，AI 会自动解析您的输入并提取以下信息：

#### 1. 优先级识别
- **紧急** (`urgent`)：包含"紧急"、"急"、"重要"、"高优先级"等关键词
- **高** (`high`)：包含"重要"、"高"等关键词
- **中等** (`medium`)：默认优先级
- **低** (`low`)：包含"不急"、"低"等关键词

#### 2. 类别识别
- **工作** (`work`)：包含"工作"、"项目"、"会议"、"报告"等关键词
- **生活** (`life`)：包含"生活"、"购物"、"家务"等关键词
- **学习** (`study`)：包含"学习"、"读书"、"课程"等关键词
- **默认** (`default`)：未匹配到特定类别

#### 3. 时间识别
- 自动识别"今天"、"明天"、"后天"、具体日期等时间表述
- 转换为标准的截止日期格式

#### 4. 预估时间
- 识别"需要1小时"、"大概30分钟"等时间描述
- 转换为分钟数存储

## 使用示例

### 示例 1：工作任务
**输入**：`明天要完成重要的项目报告，大概需要2小时`
**操作**：在输入框中输入上述文本，按 `Shift+Enter`
**AI 解析结果**：
- 文本：完成项目报告
- 优先级：高
- 类别：工作
- 截止日期：明天
- 预估时间：120分钟

### 示例 2：生活任务
**输入**：`周末去超市买菜，不急的`
**操作**：在输入框中输入上述文本，按 `Shift+Enter`
**AI 解析结果**：
- 文本：去超市买菜
- 优先级：低
- 类别：生活
- 截止日期：周末

### 示例 3：学习任务
**输入**：`紧急！今晚要复习Python课程`
**操作**：在输入框中输入上述文本，按 `Shift+Enter`
**AI 解析结果**：
- 文本：复习Python课程
- 优先级：紧急
- 类别：学习
- 截止日期：今天

## 回退机制

如果 AI 服务不可用（网络问题、API 密钥错误等），系统会自动回退到：

1. **基本关键词匹配**：使用内置的关键词匹配算法
2. **普通解析模式**：使用原有的文本解析功能

## 注意事项

1. **API 费用**：Gemini API 可能产生费用，请注意使用量
2. **网络连接**：AI 解析需要网络连接
3. **隐私保护**：您的输入会发送到 Google 服务器进行处理
4. **语言支持**：目前主要支持中文和英文
5. **快捷键**：确保在输入框中按 `Shift+Enter`，而不是在其他地方

## 故障排除

### 常见问题

1. **Shift+Enter 不起作用**
   - 确保输入框有焦点（点击输入框）
   - 确保同时按住 Shift 键和 Enter 键
   - 检查是否有其他程序占用了这个快捷键
   - 重启应用程序

2. **AI 服务不可用**
   - 检查 `.env` 文件中的 API 密钥是否正确
   - 确认网络连接正常
   - 检查 API 密钥是否有效且未过期
   - 查看控制台输出的错误信息

3. **解析结果不准确**
   - 尝试使用更清晰的描述
   - 包含更多上下文信息
   - 使用明确的时间和优先级关键词

4. **程序启动失败**
   - 确认已安装必要的依赖包
   - 检查 Python 版本兼容性
   - 运行 `python3 test_ai_service.py` 测试 AI 服务

### 测试 AI 功能

您可以使用项目中的测试脚本来验证 AI 功能：

```bash
python3 test_ai_service.py
```

这将测试 AI 服务的各种功能，帮助您诊断问题。

### 日志信息

程序会在控制台输出相关日志信息：
- `AI 服务初始化失败`: API 密钥配置问题
- `AI 解析错误`: 网络或解析问题
- `AI 解析失败，回退到普通解析`: 自动回退到基本功能

## 技术细节

### 依赖包
- `google-generativeai`: Google Gemini API 客户端
- `pydantic`: 数据验证和序列化
- `python-dotenv`: 环境变量管理

### 架构设计
- **MVC 模式**：严格的模型-视图-控制器分离
- **信号机制**：使用 PyQt5 信号槽进行组件通信
- **自定义控件**：使用 `AILineEdit` 处理 `Shift+Enter` 事件
- **错误处理**：完善的异常处理和回退机制
- **模块化**：AI 服务作为独立模块，易于维护和扩展

### 技术改进

- **v1.1 更新**：修复了 `Shift+Enter` 快捷键在 `QLineEdit` 中不工作的问题
- **自定义控件**：创建了 `AILineEdit` 类来正确处理键盘事件
- **事件处理**：使用 `keyPressEvent` 重写来捕获 `Shift+Enter` 组合键
- **v1.2 更新**：优化了 AI 服务的导入和初始化方式
- **代码简化**：移除了复杂的 `AI_AVAILABLE` 检查机制
- **导入优化**：使用标准的 `from google import genai` 导入方式
- **结构化输出**：使用 Pydantic 模型和 Gemini 的结构化输出功能 